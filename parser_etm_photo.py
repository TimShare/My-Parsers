import requests
from bs4 import BeautifulSoup
import os

def save_img(photo_url, id, mkdir_needs=0, k=0):
    if not mkdir_needs:
        p = requests.get(photo_url)
        out = open(f"/Users/timursarafiev/Desktop/kosmos_photo/{id}.jpg", "wb")
        out.write(p.content)
        out.close()
    else:
        path_to_folder = f"/Users/timursarafiev/Desktop/se/parsed"
        os.mkdir(f"{path_to_folder}/{id}") if not os.path.exists(
            f"{path_to_folder}/{id}") else None
        p = requests.get(photo_url)
        out = open(f"{path_to_folder}/{id}/{k}.jpg", "wb")
        out.write(p.content)
        out.close()


etm_code = ['9723054', '9723055', '9723092', '9723087', '9723104', '4362734', '9723105', '9723100', '6099395',
            '9741134', '9742426', '9741132', '9769119', '9723073', '174821', '612733', '9742435', '9723102', '9741135',
            '7297256', '9769125', '2693908', '9723094', '9723101', '9723098', '6499408', '9723082', '5513803',
            '3110614', '741340', '8830324', '8711432', '9723093', '6025917', '8411041', '7139622', '3585540', '739551',
            '9742434', '1904194', '5881289', '5432239', '7539676', '9723095', '9723075', '4954107', '857537', '9818522',
            '6172167', '9734421', '3816205', '5936045', '2808569', '9769120', '2416337', '4978938', '8684575',
            '9769126', '4311235', '4605699', '9734632', '9769121', '240221', '9723063', '4473600', '3688592', '4774173',
            '8567033', '4150982', '9741137', '8485479', '4543410', '9818514', '9719909', '9723086', '962282', '9734422',
            '9692149', '7247967', '5457473', '5977467', '9742425', '8861315', '1194597', '9526745', '9734610',
            '9886216', '9818515', '2188821', '2813170', '1236282', '6822985', '6127909', '6827031', '5160381',
            '8760395', '9760253', '5406589', '5216407', '741866', '9877781', '7846305', '7920826', '6397014', '4782807',
            '9879267', '9667473', '9877943', '9818516', '9734643', '9734636', '933257', '9739947', '9723057', '9534335',
            '9723077', '9773994', '9734605', '8665270', '9737523', '7715943', '9734640', '9723096', '9734608',
            '5650499', '9739946', '79548', '388090', '9877786', '9818517', '9734633', '2092190', '617788', '9734611',
            '9723099', '9667693', '3760705', '8748369', '6714983', '8602582', '8348307', '2450030', '3173127',
            '6198196', '3881389', '3841870', '2128371', '9783597', '6579990', '9723059', '6678416', '8514244',
            '3085926', '4597567', '1047999', '9734428', '9734604', '6520750', '5154166', '9769123', '6796697',
            '8125600', '5840357', '702646', '3511712', '9375871', '7764237', '5441889', '2820982', '2364093', '15969',
            '1816953', '7791688', '8039036', '7981307', '7150126', '9245898', '3604899', '50884', '574251', '308333',
            '931936', '1125673', '1331754', '6071524', '2493973', '4506150', '8468033', '9182212', '6213128', '6671643',
            '7229218', '7699396', '9737521', '3906456', '5078531', '3736431', '4650897', '5835913', '5685384',
            '5530930', '8403676', '9734427', '7455427', '8357397', '4380790', '9743451', '9334048', '7913440', '404501',
            '306669', '2616607', '2333280', '4371885', '885038', '1994792', '5543489', '7599826', '7053358', '1247003',
            '4764760', '2640577', '3598129', '468718', '6008563', '2102356', '9249717', '9114236', '7549022', '6846266',
            '6818752', '2225473', '2520789', '3497661', '2887545', '885053', '936806', '1517808', '859538', '2207910',
            '2189930', '2439221', '2467807', '2468696', '2097566', '2051177', '5476886', '5084647', '5079263',
            '4398833', '3844924', '4296124', '4112119', '4091627', '4600557', '4086643', '482279', '585262', '148147',
            '2852277', '3837389', '5830073', '5652647', '5564504', '6647796', '6826654', '6641523', '6194580',
            '9020453', '9381940', '8874825', '9533866', '9533867', '9534334', '9731457', '9731462', '9731468',
            '9731856', '9681156', '9720413', '7200159', '6974917', '6942553', '8352714', '8088595', '7958845',
            '9745846', '9748429', '9760261', '9760266', '9760443', '9877779', '9877784', '9877791', '9877797',
            '9877804', '9877810', '9877813', '73500002', '9817903', '9877734', '9877656', '9821217', '9783885',
            '9814020', '9812967', '9810435', '9810434', '9810427', '9810426', '9810417', '9800412', '9737522']

print(len(etm_code[:etm_code.index("15969")]))

r = requests.Session()
headers = {
    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36'}
r.headers = headers
for id in etm_code:
    url = f"https://www.etm.ru/cat/nn/{id}"
    etm_text = r.get(url)
    bs = BeautifulSoup(etm_text.text, "lxml")
    k = 0
    try:
        photo_url = bs.find_all("a", "jss469")
        for i in photo_url:
            url = i.find("img").get("src").replace("small_", "")
            save_img(url, id, 1, k)
            k += 1
    except Exception as ex:
        print(id, ex)
